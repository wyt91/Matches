<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- é€‚é…ç§»åŠ¨è®¾å¤‡ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è€åƒçš„ç«æŸ´</title>
  <style>
    body {
      background-color: black;
      color: orange;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1, h2, p {
      margin: 10px;
    }
    input, button {
      font-size: 24px;
      padding: 10px;
      margin: 5px;
    }
    #betButtons button {
      width: 100px;
    }
    .match {
      font-size: 50px;
      cursor: pointer;
      display: inline-block;
      margin: 5px;
      user-select: none;
    }
    #gameButtons button {
      font-size: 24px;
      margin: 10px;
      padding: 10px 15px;
    }
    .row {
      margin: 15px 0;
    }
    /* ç»“æœé¡µä¸­è´·æ¬¾/ç»“æŸé€‰é¡¹ */
    #loanOptions button {
      font-size: 24px;
      padding: 10px 15px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <!-- ä¸‹æ³¨é¡µé¢ï¼ˆå«åå­—è¾“å…¥ï¼‰ -->
  <div id="betPage">
    <h1>è€åƒçš„ç«æŸ´</h1>
    <div id="nameSection">
      <input type="text" id="playerName" placeholder="è¯·è¾“å…¥åå­—">
      <button id="startGame">å¼€å§‹</button>
    </div>
    <div id="betSection" style="display:none;">
      <h2 id="creditDisplay">ç­¹ç : 100</h2>
      <p>è¯·é€‰æ‹©èµŒæ³¨ï¼š</p>
      <div id="betButtons"></div>
    </div>
  </div>

  <!-- æ¸¸æˆé¡µé¢ -->
  <div id="gamePage" style="display:none;">
    <h1>è€åƒçš„ç«æŸ´</h1>
    <h2 id="gameCredit"></h2>
    <div id="gameBoard">
      <div class="row" data-row="0"></div>
      <div class="row" data-row="1"></div>
      <div class="row" data-row="2"></div>
    </div>
    <div id="gameButtons">
      <button id="undoButton">æ’¤å›</button>
      <button id="endTurnButton">ç»“æŸå›åˆ</button>
      <button id="surrenderButton">æŠ•é™</button>
    </div>
  </div>

  <!-- ç»“æœé¡µé¢ -->
  <div id="resultPage" style="display:none;">
    <h2 id="resultMessage"></h2>
    <!-- æ­£å¸¸ç»§ç»­æŒ‰é’® -->
    <button id="continueButton">ç»§ç»­</button>
    <!-- å½“ç­¹ç ä¸º0æ—¶æ˜¾ç¤ºè´·æ¬¾/ç»“æŸé€‰é¡¹ -->
    <div id="loanOptions" style="display:none;">
      <button id="loanButton">è´·æ¬¾</button>
      <button id="endGameButton">ç»“æŸæ¸¸æˆ</button>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    var playerName = "";
    var credit = 100;
    var borrowed = false; // æ˜¯å¦å·²è´·æ¬¾
    var currentBet = 0;
    // æ¸¸æˆå±€é¢ï¼šä¸‰è¡Œç«æŸ´ï¼Œåˆå§‹åˆ†åˆ«ä¸º 3, 5, 7
    var gameState = [3, 5, 7];
    // è®°å½•æœ¬å›åˆç©å®¶ç‚¹å‡»çš„æ“ä½œï¼ˆç”¨äºæ’¤å›ï¼‰ï¼Œæ¯é¡¹ {row: è¡Œå·}
    var currentTurnMoves = [];
    // æœ¬å›åˆåªèƒ½åœ¨åŒä¸€è¡Œæ“ä½œï¼Œnull è¡¨ç¤ºå°šæœªç¡®å®š
    var selectedRow = null;
    // AI çš„å¿…èƒœå±€é¢ç›®æ ‡ï¼ˆæ’åºåçš„æ•°å­—å­—ç¬¦ä¸²ï¼Œé¡ºåºæ— å…³ï¼Œå¦‚"123"å¯ä»£è¡¨ä»»æ„é¡ºåºçš„1,2,3ï¼‰
    var winningConfigs = ["001", "111", "022", "033", "044", "055", "123", "145", "246"];

    // æ›´æ–°ä¸‹æ³¨é¡µé¢æ˜¾ç¤ºç­¹ç 
    function updateBetPage() {
      document.getElementById("creditDisplay").innerText = "ç­¹ç : " + credit;
    }

    // æ˜¾ç¤ºæŒ‡å®šé¡µé¢ï¼Œéšè—å…¶ä»–é¡µé¢
    function showPage(pageId) {
      document.getElementById("betPage").style.display = "none";
      document.getElementById("gamePage").style.display = "none";
      document.getElementById("resultPage").style.display = "none";
      document.getElementById(pageId).style.display = "block";
    }

    // åˆå§‹åŒ–æ¸¸æˆå±€é¢åŠç›¸å…³å˜é‡
    function initializeGameState() {
      gameState = [3, 5, 7];
      selectedRow = null;
      currentTurnMoves = [];
      renderGameBoard();
    }

    // æ¸²æŸ“æ¸¸æˆæ¿ï¼Œæ ¹æ® gameState æ›´æ–°æ¯è¡Œç«æŸ´
    function renderGameBoard() {
      var rows = document.getElementsByClassName("row");
      for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        row.innerHTML = "";
        for (var j = 0; j < gameState[i]; j++) {
          var span = document.createElement("span");
          span.innerText = "ğŸ”¥";
          span.className = "match";
          span.dataset.row = i;
          span.addEventListener("click", function() {
            var rowIndex = this.dataset.row;
            // æœ¬å›åˆåªèƒ½åœ¨åŒä¸€æ’æ“ä½œ
            if (selectedRow === null || selectedRow == rowIndex) {
              selectedRow = rowIndex;
              // ç‚¹å‡»åç›´æ¥ç§»é™¤æ­¤ç«æŸ´
              this.remove();
              currentTurnMoves.push({row: parseInt(rowIndex)});
              // æ›´æ–°å±€é¢
              gameState[rowIndex]--;
            } else {
              alert("æœ¬å›åˆåªèƒ½åœ¨åŒä¸€æ’æ¶ˆé™¤ï¼Œè‹¥è¦æ¢è¡Œè¯·æ’¤å›æ“ä½œ");
            }
          });
          row.appendChild(span);
        }
      }
      document.getElementById("gameCredit").innerText = "ç­¹ç : " + credit + "   èµŒæ³¨: " + currentBet;
    }

    // æ’¤å›ä¸Šä¸€æ¬¡æ“ä½œ
    function undoMove() {
      if (currentTurnMoves.length > 0) {
        var lastMove = currentTurnMoves.pop();
        gameState[lastMove.row]++;
        selectedRow = currentTurnMoves.length > 0 ? currentTurnMoves[0].row : null;
        renderGameBoard();
      }
    }

    // ç»“æŸç©å®¶å›åˆï¼ˆå¿…é¡»è‡³å°‘æ¶ˆé™¤ä¸€ä¸ªç«æŸ´ï¼‰
    function endPlayerTurn() {
      if (currentTurnMoves.length === 0) {
        alert("è¯·è‡³å°‘ç§»é™¤ä¸€ä¸ªç«æŸ´å†ç»“æŸå›åˆ");
        return;
      }
      // è‹¥ç©å®¶æ‹¿èµ°æœ€åä¸€æ ¹ç«æŸ´ï¼Œåˆ™åˆ¤è¾“
      if (gameState[0] + gameState[1] + gameState[2] === 0) {
        roundEnd(false);
        return;
      }
      // é‡ç½®æœ¬å›åˆè®°å½•ï¼Œè¿›å…¥ AI å›åˆ
      currentTurnMoves = [];
      selectedRow = null;
      setTimeout(function() { aiTurn(); }, 500);
    }

    // AI å›åˆï¼šå°è¯•æ‰§è¡Œå¿…èƒœç­–ç•¥ï¼ˆå±€é¢æ’åºååŒ¹é…ç›®æ ‡ç»„åˆï¼‰ï¼Œå¦åˆ™ç§»é™¤ä¸€æ ¹ç«æŸ´
    function aiTurn() {
      var bestMove = null;
      for (var row = 0; row < 3; row++) {
        if (gameState[row] > 0) {
          for (var remove = 1; remove <= gameState[row]; remove++) {
            var newState = gameState.slice();
            newState[row] -= remove;
            // å¯¹å±€é¢æ’åºåæ„é€ å­—ç¬¦ä¸²ï¼ˆé¡ºåºæ— å…³ï¼‰
            var sortedState = newState.slice().sort(function(a, b){ return a - b; }).join("");
            if (winningConfigs.indexOf(sortedState) !== -1) {
              bestMove = {row: row, remove: remove};
              break;
            }
          }
          if (bestMove) break;
        }
      }
      // å¦‚æœæ²¡æœ‰å¿…èƒœèµ°æ³•ï¼Œåˆ™ä»ç¬¬ä¸€è¡Œéç©ºè¡Œç§»é™¤ä¸€æ ¹
      if (!bestMove) {
        for (var row = 0; row < 3; row++) {
          if (gameState[row] > 0) {
            bestMove = {row: row, remove: 1};
            break;
          }
        }
      }
      if (bestMove) {
        gameState[bestMove.row] -= bestMove.remove;
        alert("AI åœ¨ç¬¬ " + (parseInt(bestMove.row) + 1) + " æ’ç§»é™¤äº† " + bestMove.remove + " æ ¹ç«æŸ´");
        renderGameBoard();
      }
      // è‹¥å±€é¢ç©ºï¼Œåˆ™ AI æ‹¿èµ°æœ€åä¸€æ ¹ï¼Œåˆ¤å®š AI è¾“ï¼Œç©å®¶è·èƒœ
      if (gameState[0] + gameState[1] + gameState[2] === 0) {
        roundEnd(true);
      }
    }

    // å›åˆç»“æŸï¼ŒplayerWin ä¸º true è¡¨ç¤ºç©å®¶èµ¢ï¼Œfalse è¡¨ç¤ºç©å®¶è¾“
    function roundEnd(playerWin) {
      if (playerWin) {
        alert("ä½ èµ¢äº†è¿™ä¸€å±€ï¼");
        credit += currentBet;
        document.getElementById("resultMessage").innerText = "ä½ èµ¢äº†ï¼";
      } else {
        alert("ä½ è¾“äº†è¿™ä¸€å±€ï¼");
        credit -= currentBet;
        document.getElementById("resultMessage").innerText = "ä½ è¾“äº†ï¼";
      }
      
      // æ£€æŸ¥ç­¹ç æƒ…å†µï¼š
      // å¦‚æœç­¹ç ä¸è¶³ï¼ˆ<= 0ï¼‰ï¼Œæ˜¾ç¤ºè´·æ¬¾/ç»“æŸæ¸¸æˆé€‰é¡¹
      if (credit <= 0) {
        document.getElementById("continueButton").style.display = "none";
        document.getElementById("loanOptions").style.display = "block";
        // å¦‚æœå·²ç»è´·æ¬¾ï¼Œåˆ™ä¸èƒ½å†è´·æ¬¾
        if (borrowed) {
          document.getElementById("loanButton").style.display = "none";
        } else {
          document.getElementById("loanButton").style.display = "inline-block";
        }
      } else {
        // æ­£å¸¸æ˜¾ç¤ºâ€œç»§ç»­â€æŒ‰é’®
        document.getElementById("continueButton").style.display = "inline-block";
        document.getElementById("loanOptions").style.display = "none";
      }
      showPage("resultPage");
    }

    // ç»‘å®šå„é¡µé¢æŒ‰é’®äº‹ä»¶
    document.getElementById("startGame").addEventListener("click", function() {
      var nameInput = document.getElementById("playerName").value;
      if (nameInput.trim() === "") {
        alert("è¯·è¾“å…¥åå­—");
        return;
      }
      playerName = nameInput;
      document.getElementById("betSection").style.display = "block";
      updateBetPage();
    });

    // ç”Ÿæˆä¸‹æ³¨æŒ‰é’®
    var betAmounts = [10, 20, 50, 100, 200, 500, 1000];
    var betButtonsDiv = document.getElementById("betButtons");
    betAmounts.forEach(function(amount) {
      var btn = document.createElement("button");
      btn.innerText = amount;
      btn.addEventListener("click", function() {
        currentBet = amount;
        initializeGameState();
        showPage("gamePage");
      });
      betButtonsDiv.appendChild(btn);
    });

    document.getElementById("undoButton").addEventListener("click", function() {
      undoMove();
    });

    document.getElementById("endTurnButton").addEventListener("click", function() {
      endPlayerTurn();
    });

    document.getElementById("surrenderButton").addEventListener("click", function() {
      roundEnd(false);
    });

    // â€œç»§ç»­â€æŒ‰é’®ï¼šç­¹ç è¶³å¤Ÿæ—¶ï¼Œå›åˆ°ä¸‹æ³¨é¡µé¢ï¼ˆä¿ç•™å½“å‰ç­¹ç ï¼‰
    document.getElementById("continueButton").addEventListener("click", function() {
      showPage("betPage");
      updateBetPage();
    });

    // â€œè´·æ¬¾â€æŒ‰é’®ï¼šå¦‚æœé€‰æ‹©è´·æ¬¾ï¼Œåˆ™å°†ç­¹ç è®¾ä¸º 100ï¼Œå¹¶æ ‡è®°å·²è´·æ¬¾ï¼Œç„¶åå›åˆ°ä¸‹æ³¨é¡µé¢
    document.getElementById("loanButton").addEventListener("click", function() {
      borrowed = true;
      credit = 100;
      alert("å·²è´·æ¬¾ 100 ç­¹ç ");
      showPage("betPage");
      updateBetPage();
    });

    // â€œç»“æŸæ¸¸æˆâ€æŒ‰é’®ï¼šç»“æŸå½“å‰æ¸¸æˆï¼Œå›åˆ°æœ€åˆçš„åå­—è¾“å…¥é¡µé¢ï¼Œé‡ç½®æ‰€æœ‰æ•°æ®
    document.getElementById("endGameButton").addEventListener("click", function() {
      // é‡ç½®çŠ¶æ€
      playerName = "";
      credit = 100;
      borrowed = false;
      currentBet = 0;
      document.getElementById("playerName").value = "";
      document.getElementById("betSection").style.display = "none";
      showPage("betPage");
      updateBetPage();
    });
  </script>
</body>
</html>
